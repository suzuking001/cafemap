食べ歩きヒートマップ（カテゴリ別・偏差値）

英語版: `README.en.md`

- OSMの飲食系スポットを現在の地図範囲から取得し、カテゴリごとに重み付けしてグリッドでスコア化・可視化するシングルページアプリです。
- 偏差値ラベル、ポイント表示、グリッドサイズ調整、結果のGeoJSON保存/読み込みに対応しています。

**特長**
- Leafletで軽快に動作するクライアントサイドのみの構成
- Overpass APIから`amenity`/`shop`タグ対象を取得（冗長化のため複数エンドポイントを順に試行）
- カテゴリごとのチェック＋重みスライダー（0.0〜1.0）
- スコア→平均・標準偏差から偏差値を算出し、色（YlOrRd）と数値ラベルで表示
- 取得結果をGeoJSONとして保存／外部GeoJSONを読み込み可能

**動かし方（ローカル）**
- そのまま`index.html`をブラウザで開いても動きますが、位置情報APIはHTTPSまたは`http://localhost`が必要です。
- 確実に動かすには、簡易サーバで配信してください。
  - Python: `python -m http.server 8080` → `http://localhost:8080/` を開く
  - Node.js(serve): `npx serve .` → 表示されたURLを開く

**使い方**
- 地図を見たい範囲へ移動（右下の現在地ボタンでも移動可能）
- 左下パネルでカテゴリを選択し、重みをスライダーで調整
- 表示設定でヒートマップ/ラベル/ポイントのON/OFF、グリッドサイズを調整
- 右下の「ヒートマップ生成」ボタンを押して集計・描画
- 結果をGeoJSONで保存／外部GeoJSONを読み込んで再描画も可能

**仕組みの概要**
- 現在表示中のバウンディングボックスに対してOverpass APIへクエリを投げ、該当スポットを取得します。
- 指定セル幅（km）の正方グリッドを作成し、セル内ポイントの重み合計をスコアとします。
- スコア列から平均・標準偏差を用いて偏差値（50±10）を算出してセル中央に表示します。

**主な実装箇所**
- カテゴリ定義と判定: `index.html:258`
- タイル/地図初期化: `index.html:328`
- 位置情報ボタンの処理: `index.html:420`
- ヒートマップ生成（取得〜集計〜描画）: `index.html:449`
- 結果の保存（GeoJSON）: `index.html:579`

**使用データ・ライセンス**
- 地図データ: © OpenStreetMap contributors（ODbL）
- 地図タイル: tile.openstreetmap.org（OSMFの利用ポリシーに従ってください）

**使用ライブラリ**
- Leaflet（BSD-2-Clause）
- Turf.js（MIT）
- chroma.js（BSD-3-Clause）

**注意・制限**
- Overpass APIはレート制限や負荷対策があります。高頻度の連続実行は避け、失敗時は時間をおいて再試行してください。
- 位置情報APIはHTTPSまたは`http://localhost`でのみ取得可能です。ブラウザやOSの設定に依存します。
- OSM由来の派生データ（保存したGeoJSONを含む）の再配布はODbLその他の条件に従ってください。
- タイルサーバのポリシーを守ってご利用ください。高トラフィック用途は別プロバイダをご検討ください。

**カスタマイズ**
- カテゴリの追加/ラベル・色・判定ロジックは`CATS`定数で編集できます（`index.html:258`）。
- グリッド幅の初期値、UI文言なども`index.html`内で調整可能です。

**デプロイ（GitHub Pages）**
- 本リポジトリをGitHubにPush → Settings → Pages → Branchを`main`/`docs`などに設定 → 公開URLで`index.html`がそのまま動作します。
- 位置情報を使う場合はHTTPSの公開URLでアクセスしてください。

ご意見・改善案歓迎です。Issue/PRお待ちしています。

**スクリーンショット**
- `assets/` 配下に画像を配置して、以下のようにREADMEへ貼り付けてください。
  - 例: `![トップ画面](assets/screenshot-1.png)`
